name: Build Exporter Executable
# TODO: will be created for both windows and linux environments
on:
    workflow_call:
        inputs:
            ref:
                required: false
                type: string

jobs:
    build-executable:
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v4
              with:
                  ref: ${{ inputs.ref }}
            - name: Set up Go
              uses: actions/setup-go@v4
              with:
                  go-version: "1.22"
            - run: git submodule update --init --recursive
            - name: Build Exporter
              run: |
                  echo "Building collector binary package"
                  TAG_NAME=$(cat .ver)
                  export GOOS=linux
                  go build -o ./bin/exporter-linux-$TAG_NAME ./cmd/exporter/
                  echo "Done bulding executable"
            - name: Upload a Build Artifact
              uses: actions/upload-artifact@v4.6.2
              with:
                  # Artifact name
                  name: artifact-build
                  # A file, directory or wildcard pattern that describes what to upload
                  path: ./bin
